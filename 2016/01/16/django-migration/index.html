<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a5e8b4cdb714c135f08d.css">.container-404{font-family:Arial;height:500vw;-webkit-overflow-scrolling:touch;overflow-x:hidden;display:flex;justify-content:center;align-items:center;position:fixed;left:0;top:0;width:100vw;height:100vh;overflow:hidden;opacity:0;transition:opacity 1s}.container-404>span{padding:1.5vh;font-size:25vh;font-weight:700;color:#333;cursor:default}.container-404>.home{position:fixed;right:3vw;bottom:3vw;margin:0;padding:0;color:#999;cursor:pointer;text-decoration:underline;font-size:13px}abbr,address,article,aside,audio,b,blockquote,body,canvas,cite,code,dd,del,details,dfn,div,dl,dt,em,fieldset,figcaption,figure,footer,form,header,hgroup,html,i,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,p,pre,q,samp,section,small,span,strong,sub,summary,sup,time,ul,var,video{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}iframe,img{width:100%}iframe{margin:20px 0}.adsbygoogle iframe{margin:0}nav ul{list-style:none}blockquote,q{quotes:none}blockquote>p>a{display:inline-block}h1,h2,h3,h4,h5,h6{margin-top:.5em;margin-bottom:.5em;padding-top:1em}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}ins{text-decoration:none}ins,mark{background-color:#fff;color:#000}mark{font-style:italic;font-weight:700}del{text-decoration:line-through}abbr[title],dfn[title]{border-bottom:1px dotted;cursor:help}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}p{margin-bottom:1.8rem}code.language-text{font-size:14px!important}table{margin:40px auto;width:80%;border-spacing:0;border-collapse:collapse}table,table tr{padding:0;border-top:1px solid #ccc}table tr{background-color:#fff;margin:0}table tr:nth-child(2n){background-color:#f8f8f8}table tr th{font-weight:700}table tr td,table tr th{border-bottom:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}table tr td :first-child,table tr th :first-child{margin-top:0}table tr td:not(:first-child),table tr th:not(:first-child){border-left:1px solid #ccc}table tr td :last-child,table tr th :last-child{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.contents a{transition:background .5s}.contents a:not(.gatsby-resp-image-link){color:#3a3a3a;text-decoration:none;border-bottom:3px solid #d7c3ee}.contents nav.table-of-contents a{color:#888;text-decoration:none;border-bottom:none;transition:"all 0.3s"}.contents nav.table-of-contents a>u{text-decoration:none}.contents nav.table-of-contents ul li p{margin-bottom:0}.contents a:active:not(.gatsby-resp-image-link),.contents a:hover:not(.gatsby-resp-image-link){outline-width:0;text-shadow:none;background-color:#e0d6eb}.contents a.anchor-header{border:none;top:20px}.contents a.anchor-header:hover{background:none}.contents ul{margin-left:15px;margin-bottom:1.8rem}.contents ol{margin-left:20px;margin-bottom:1.8rem}.contents ul li a{word-break:break-all}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d;margin-top:.1rem;margin-bottom:1.8rem;border-radius:4px}@media (max-width:600px){pre[class*=language-]{margin-left:-1rem;margin-right:-1rem;font-size:.875rem;border-radius:0}}:not(pre)>code[class*=language-]{background:#dfdfdf;color:#222;padding:3px 5px;font-weight:600}blockquote{margin:20px 15px 20px 0;padding-left:20px;border-left:5px solid #e5e5e5}.frame-wrap{overflow:auto;-webkit-overflow-scrolling:touch;width:100%}#gatsby-noscript{display:none}</style><meta name="generator" content="Gatsby 2.21.33"/><style type="text/css">
    .anchor-header.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor-header.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor-header svg,
    h2 .anchor-header svg,
    h3 .anchor-header svg,
    h4 .anchor-header svg,
    h5 .anchor-header svg,
    h6 .anchor-header svg {
      visibility: hidden;
    }
    h1:hover .anchor-header svg,
    h2:hover .anchor-header svg,
    h3:hover .anchor-header svg,
    h4:hover .anchor-header svg,
    h5:hover .anchor-header svg,
    h6:hover .anchor-header svg,
    h1 .anchor-header:focus svg,
    h2 .anchor-header:focus svg,
    h3 .anchor-header:focus svg,
    h4 .anchor-header:focus svg,
    h5 .anchor-header:focus svg,
    h6 .anchor-header:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=edf3d310d67f8284a562bc3a58c3e761"/><title data-react-helmet="true">[django] 장고 트랜잭션 활용 | bono blog</title><meta data-react-helmet="true" name="google-site-verification" content="R3ZeY1PmaJUY9j_cgNABjesJFgHWVCJpb4TsdfXntMA"/><meta data-react-helmet="true" name="naver-site-verification" content="23eddf7267bb527337927baff11fc26157637f30"/><meta data-react-helmet="true" name="description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:title" content="[django] 장고 트랜잭션 활용"/><meta data-react-helmet="true" property="og:description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creater" content="@blueshw"/><meta data-react-helmet="true" name="twitter:title" content="[django] 장고 트랜잭션 활용"/><meta data-react-helmet="true" name="twitter:description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"Article","name":"[django] 장고 트랜잭션 활용","datePublished":"2016-01-16"}</script><style data-styled="" data-styled-version="5.1.0">.jlBFUE{box-sizing:border-box;margin:0;min-width:0;}/*!sc*/
@media screen and (max-width:768px){.jlBFUE{overflow-x:hidden;}}/*!sc*/
.oDrAC{box-sizing:border-box;margin:0;min-width:0;}/*!sc*/
.JUcFW{box-sizing:border-box;margin:0;min-width:0;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;margin-right:auto;margin-left:20px;margin-top:3px;color:#888888;font-size:22px;}/*!sc*/
.TIKcy{box-sizing:border-box;margin:0;min-width:0;margin-top:50px;}/*!sc*/
.hQDHLU{box-sizing:border-box;margin:0;min-width:0;margin:10px;}/*!sc*/
.gGRPKY{box-sizing:border-box;margin:0;min-width:0;margin-top:15px;margin-bottom:15px;width:100vw;font-size:16px;}/*!sc*/
.fvzetK{box-sizing:border-box;margin:0;min-width:0;font-weight:400;color:#888888;}/*!sc*/
.gnKHtn{box-sizing:border-box;margin:0;min-width:0;max-width:720px;margin-left:auto;margin-right:auto;padding:45px 15px;}/*!sc*/
.ewrCCO{box-sizing:border-box;margin:0;min-width:0;position:relative;}/*!sc*/
.bTOZqD{box-sizing:border-box;margin:0;min-width:0;position:absolute;top:0;height:100%;right:calc((100vw - 720px) / 2 * (-1));}/*!sc*/
.jRJUDy{box-sizing:border-box;margin:0;min-width:0;display:none;margin-top:80px;color:#888888;width:calc((100vw - 720px) / 2 - 50px);}/*!sc*/
@media screen and (min-width:1200px){.jRJUDy{position:-webkit-sticky;position:sticky;top:70px;display:block;max-width:360px;margin-right:20px;overflow:auto;word-break:break-word;max-height:calc(100vh - 200px);font-size:14px;}}/*!sc*/
.bRFRSg{box-sizing:border-box;margin:0;min-width:0;margin-bottom:15px;margin-left:20px;}/*!sc*/
.bDBjTL{box-sizing:border-box;margin:0;min-width:0;}/*!sc*/
.bDBjTL ul{list-style:none;margin-left:20px;margin-bottom:0px;}/*!sc*/
.bDBjTL ul > li{line-height:1.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}/*!sc*/
.bDBjTL ul > li a[href="undefined"]{font-size:15px;color:#333333;font-weight:600;}/*!sc*/
.lnZVqJ{box-sizing:border-box;margin:0;min-width:0;font-size:24px;line-height:1.1;}/*!sc*/
.hqA-DBX{box-sizing:border-box;margin:0;min-width:0;margin-bottom:70px;margin-top:7px;color:#bbb;}/*!sc*/
.gVBYLb{box-sizing:border-box;margin:0;min-width:0;margin-bottom:40px;}/*!sc*/
.dWOsdk{box-sizing:border-box;margin:0;min-width:0;margin-top:30px;}/*!sc*/
.erUgeX{box-sizing:border-box;margin:0;min-width:0;line-height:1.8;margin-right:5px;}/*!sc*/
.hTHPLs{box-sizing:border-box;margin:0;min-width:0;line-height:1.8;margin-left:5px;text-align:right;}/*!sc*/
data-styled.g1[id="sc-AxjAm"]{content:"jlBFUE,oDrAC,JUcFW,TIKcy,hQDHLU,gGRPKY,fvzetK,gnKHtn,ewrCCO,bTOZqD,jRJUDy,bRFRSg,bDBjTL,lnZVqJ,hqA-DBX,gVBYLb,dWOsdk,erUgeX,hTHPLs,"}/*!sc*/
.bFyVYh{box-sizing:border-box;margin:0;min-width:0;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g2[id="sc-AxirZ"]{content:"bFyVYh,"}/*!sc*/
.hDyThI{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g3[id="menu___StyledLink-h1woa4-0"]{content:"hDyThI,"}/*!sc*/
.fNZIRf{box-sizing:border-box;margin:0;min-width:0;width:100%;padding:10px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:white;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-transform:translateY(0px);-ms-transform:translateY(0px);transform:translateY(0px);-webkit-transition:-webkit-transform 0.5s ease;-webkit-transition:transform 0.5s ease;transition:transform 0.5s ease;-webkit-transition-delay:0.2s;transition-delay:0.2s;position:fixed;left:0;top:0;height:50px;border-bottom:1px solid #e8e8e8;z-index:200;}/*!sc*/
data-styled.g4[id="header___StyledFlex-sc-1h24lom-0"]{content:"fNZIRf,"}/*!sc*/
.jCYSyw{cursor:pointer;}/*!sc*/
@media (max-width:600px){.jCYSyw{margin-left:10px;}}/*!sc*/
data-styled.g5[id="header___StyledText-sc-1h24lom-1"]{content:"jCYSyw,"}/*!sc*/
.hUslui{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g6[id="header___StyledLink-sc-1h24lom-2"]{content:"hUslui,"}/*!sc*/
.cfExc{box-sizing:border-box;margin:0;min-width:0;padding:5px;width:30px;height:28px;cursor:pointer;overflow:hidden;}/*!sc*/
data-styled.g7[id="header___StyledBox-sc-1h24lom-3"]{content:"cfExc,"}/*!sc*/
.bIHSbr{box-sizing:border-box;margin:0;min-width:0;width:20px;padding-top:2px;margin-bottom:6px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 0;-ms-transform-origin:100% 0;transform-origin:100% 0;}/*!sc*/
data-styled.g8[id="header___StyledBox2-sc-1h24lom-4"]{content:"bIHSbr,"}/*!sc*/
.dGGuYB{box-sizing:border-box;margin:0;min-width:0;width:20px;padding-top:2px;margin-bottom:6px;background-color:#888888;-webkit-transition:-webkit-transform 0.5s;-webkit-transition:transform 0.5s;transition:transform 0.5s;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin:100% 50%;-ms-transform-origin:100% 50%;transform-origin:100% 50%;}/*!sc*/
data-styled.g9[id="header___StyledBox3-sc-1h24lom-5"]{content:"dGGuYB,"}/*!sc*/
.joQhaw{box-sizing:border-box;margin:0;min-width:0;width:20px;padding-top:2px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 100%;-ms-transform-origin:100% 100%;transform-origin:100% 100%;}/*!sc*/
data-styled.g10[id="header___StyledBox4-sc-1h24lom-6"]{content:"joQhaw,"}/*!sc*/
.jUexMi{box-sizing:border-box;margin:0;min-width:0;width:100%;background-color:#f3f3f3;border-bottom:none;position:fixed;left:0;top:50px;z-index:100;opacity:0.9;max-height:0px;-webkit-transition:max-height 0.3s ease;transition:max-height 0.3s ease;overflow:hidden;}/*!sc*/
data-styled.g11[id="header___StyledBox5-sc-1h24lom-7"]{content:"jUexMi,"}/*!sc*/
.FBSAn{box-sizing:border-box;margin:0;min-width:0;color:#333333;line-height:30px;position:static;}/*!sc*/
data-styled.g18[id="blog-post___StyledBox-sc-13kot0y-0"]{content:"FBSAn,"}/*!sc*/
.bcrMFq{box-sizing:border-box;margin:0;min-width:0;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:30px;padding-top:30px;font-size:15px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-top:1px solid #eee;}/*!sc*/
data-styled.g19[id="blog-post___StyledFlex-sc-13kot0y-1"]{content:"bcrMFq,"}/*!sc*/
.jSdESJ{max-width:280px;}/*!sc*/
data-styled.g20[id="blog-post___StyledText-sc-13kot0y-2"]{content:"jSdESJ,"}/*!sc*/
.gWWQOa{max-width:280px;}/*!sc*/
data-styled.g21[id="blog-post___StyledText2-sc-13kot0y-3"]{content:"gWWQOa,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-d6f29b461ec6e5e27abd.js"/><link as="script" rel="preload" href="/framework-bd5a53d96a17218f4f08.js"/><link as="script" rel="preload" href="/app-0ac903aeb5bb8e84f522.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/abd3976e5c27636d99401a91b3294356515814cb-18434863fbd71bfaecce.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-ea5c8cd6ff2c235c0d08.js"/><link as="fetch" rel="preload" href="/page-data/2016/01/16/django-migration/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-AxjAm jlBFUE"><div class="sc-AxjAm oDrAC"><header width="100%" class="sc-AxjAm sc-AxirZ header___StyledFlex-sc-1h24lom-0 fNZIRf"><div color="grey01" font-size="22px" class="sc-AxjAm JUcFW header___StyledText-sc-1h24lom-1 jCYSyw"><a class="header___StyledLink-sc-1h24lom-2 hUslui" href="/">bono&#x27;s blog</a></div><div width="30px" class="sc-AxjAm header___StyledBox-sc-1h24lom-3 cfExc"><div width="20px" class="sc-AxjAm header___StyledBox2-sc-1h24lom-4 bIHSbr"></div><div width="20px" class="sc-AxjAm header___StyledBox3-sc-1h24lom-5 dGGuYB"></div><div width="20px" class="sc-AxjAm header___StyledBox4-sc-1h24lom-6 joQhaw"></div></div></header><div class="sc-AxjAm TIKcy"></div><nav width="100%" class="sc-AxjAm header___StyledBox5-sc-1h24lom-7 jUexMi"><ul class="sc-AxjAm hQDHLU"><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/programming"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">programming</span></a></li></div><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/know-frontend"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">frontend 바로알기</span></a></li></div><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/interactive-web"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">interactive web</span></a></li></div><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/gatsby"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">gatsby js</span></a></li></div><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/essay"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">essay</span></a></li></div><div class="sc-AxjAm sc-AxirZ bFyVYh"><li width="100vw" font-size="16px" style="text-align:center" class="sc-AxjAm gGRPKY"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/tags"><span font-weight="400" color="#888888" class="sc-AxjAm fvzetK">tag</span></a></li></div></ul></nav></div><main class="sc-AxjAm gnKHtn contents"><div class="sc-AxjAm ewrCCO"><div class="sc-AxjAm bTOZqD"><nav class="sc-AxjAm jRJUDy table-of-contents" color="grey01" width="calc((100vw - 720px) / 2 - 50px)"><h3 class="sc-AxjAm bRFRSg">TABLE OF CONTENTS</h3><div class="sc-AxjAm bDBjTL"><ul>
<li><a href="/2016/01/16/django-migration/#1-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0decorator%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-python--django-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98">1. 데코레이터(decorator)를 이용한 python + django 트랜잭션</a></li>
<li><a href="/2016/01/16/django-migration/#2-with-%EB%AA%85%EB%A0%B9%EC%96%B4%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98">2. with 명령어를 이용한 트랜잭션</a></li>
<li><a href="/2016/01/16/django-migration/#3-savepoint-%EB%A5%BC-%EC%A7%81%EC%A0%91-%EC%A7%80%EC%A0%95%ED%95%B4-%EC%A3%BC%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98">3. savepoint 를 직접 지정해 주는 트랜잭션</a></li>
<li><a href="/2016/01/16/django-migration/#%EA%B2%B0%EB%A1%A0">결론:</a></li>
</ul></div></nav></div><header class="sc-AxjAm oDrAC"><div font-size="24px" class="sc-AxjAm lnZVqJ">[django] 장고 트랜잭션 활용</div><div color="#bbb" class="sc-AxjAm hqA-DBX">2016-01-16</div><div class="sc-AxjAm gVBYLb"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="1331884154" data-ad-format="auto" data-full-width-responsive="true"></ins></div></header><div color="text" class="sc-AxjAm blog-post___StyledBox-sc-13kot0y-0 FBSAn"><p>최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 진행하면서 막히는 부분이 생길때마다 검색을 해보거나 파이썬 콘솔을 이용하여 검증, 또는 소스를 뜯어보며 작동원리를 파악하곤 합니다. 이 삽질과도 같은 수많은 과정들이 한순간에 끝나버리는게 아쉬워 블로그에 남겨보기로 결정했습니다. 시간이 남아돌아 글을 쓰는것은 아니지만, 글을 쓰는 행위는 어렴풋이 이해하고 있는 것들을 확실히 나의 지식으로 만드는 최고의 방법이라 생각하기에 시간을 쪼개서 지속해 나갈 생각입니다. 여러가지 부분을 다루겠지만, 체계 따위는 없습니다. 그때 그때 떠오르는 것, 또는 프로젝트 진행중에 특정부분이 막혀 정리가 필요한 시점에는 그 부분을 다루려고 합니다.</p>
<p>첫번째는 트랜잭션(transaction)입니다. 트랜잭션이 뭐냐고 물었을때 대부분의 프로그래머가 잘 알고 있을거라 생각합니다. 간단히 말해 작업 단위라 할 수 있는데, 여러개의 프로세스가 묶여져 마치 하나처럼 동작하는 방식이라 할 수 있겠습니다. 그렇기 때문에 성공 아니면 실패 두가지 결과밖에 존재하지 않겠죠. 좀더 개발적(?)인 언어로는 이렇게 말할수도 있습니다. 데이터베이스를 저장하고 수정하는 여러 작업을 하나의 쿼리로 처리할 수 없기 때문에 여러개의 쿼리로 나눠서 실행해야 하는데, 그 결과의 원자성을 보장해주기 위해 동일한 DB connection 객체를 사용하는 기술이라 할 수 있습니다. 자세한 내용은 직접 검색해 보시기 바랍니다.</p>
<blockquote>
<p><em>django 는 1.8.5 버전을 사용하였고, python 은 3.4.3 버전을 사용하였습니다.</em></p>
</blockquote>
<h3 id="1-데코레이터decorator를-이용한-python--django-트랜잭션" style="position:relative;"><a href="#1-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0decorator%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-python--django-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98" aria-label="1 데코레이터decorator를 이용한 python  django 트랜잭션 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 데코레이터(decorator)를 이용한 python + django 트랜잭션</h3>
<p>django 에서 트랜잭션을 이용하는 가장 쉬운 방법으로 데코레이터를 이용하는 방법입니다.
데코레이터를 이용하게 되면, 메서드 안에는 코드를 삽입할 필요가 없습니다.
"@transaction.atomic" 이라는 데코레이터를 붙여주기만 하면 끝입니다.
django 에서 기본적으로 제공해주는 데코레이터이므로, 따로 모듈을 설치해줄 필요도 없습니다.</p>
<p>가장 간단하게 atomic(원자성)한 트랜잭션을 처리하기 위한 손쉬운 방법이죠.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token decorator annotation punctuation">@transaction<span class="token punctuation">.</span>atomic</span>
<span class="token keyword">def</span> <span class="token function">transaction_test1</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># start transaction</span>
    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># end transaction</span></code></pre></div>
<h3 id="2-with-명령어를-이용한-트랜잭션" style="position:relative;"><a href="#2-with-%EB%AA%85%EB%A0%B9%EC%96%B4%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98" aria-label="2 with 명령어를 이용한 트랜잭션 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. with 명령어를 이용한 트랜잭션</h3>
<p>메서드 전체가 아닌 메서드의 일부분만 트랜잭션으로 묶어줄 필요가 있을 때 사용합니다.
트랜잭션으로 묶일 부분을 직접 지정해줘야 하는 불편함(?)이 있지만, 데코레이터와 마찬가지로 비교적 간단하게 처리가 가능합니다.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">transaction_test2</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 항상 save 처리됨, 예외가 발생할 경우 에러 발생</span>

    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># start transaction</span>
        b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># end transaction</span></code></pre></div>
<h3 id="3-savepoint-를-직접-지정해-주는-트랜잭션" style="position:relative;"><a href="#3-savepoint-%EB%A5%BC-%EC%A7%81%EC%A0%91-%EC%A7%80%EC%A0%95%ED%95%B4-%EC%A3%BC%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98" aria-label="3 savepoint 를 직접 지정해 주는 트랜잭션 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. savepoint 를 직접 지정해 주는 트랜잭션</h3>
<p>1 번과 2 번의 방법의 경우, 메서드 내에서(트랜잭션으로 묶여져있는) exception 이 발생하더라도 저절로 롤백이 되기 때문에 예외처리를 따로 해 줄 필요는 없습니다.
하지만, 3 번의 경우에는 savepoint 및 cummit 지점을 직접 지정해 주기 때문에 예외처리 또한 별도로 처리되어야 합니다.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">transaction_test3</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sid <span class="token operator">=</span> transaction<span class="token punctuation">.</span>savepoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># start transaction</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>

        b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        transaction<span class="token punctuation">.</span>savepoint_commit<span class="token punctuation">(</span>sid<span class="token punctuation">)</span>
        <span class="token comment"># end transaction</span>
    <span class="token keyword">except</span> Exception
        <span class="token comment"># 트랜잭션 내에서 에러 발생시 롤백처리</span>
        transaction<span class="token punctuation">.</span>savepoint_rollback<span class="token punctuation">(</span>sid<span class="token punctuation">)</span></code></pre></div>
<p>위의 세가지가 django 에서 트랜잭션을 처리하는 방법입니다. 간단한 트랜잭션 함수를 호출할 때는 위의 세가지 중에 알맞은 방법을 선택해서 처리하면 되겠습니다. 좀 더 복잡한 상황을 한번 살펴보도록 하죠.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># 첫번째 트랜잭션 메서드</span>
        first_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 두번째 트랜잭션 메서드</span>
        second_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@transaction<span class="token punctuation">.</span>atomic</span>
<span class="token keyword">def</span> <span class="token function">first_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

    b<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@transaction<span class="token punctuation">.</span>atomic</span>
<span class="token keyword">def</span> <span class="token function">second_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    c<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

    d<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>위의 경우에는 트랜잭션 메서드 두개를 묶어서 또다른 트랜잭션을 구성하였습니다.
각각의 메서드는 독자적읜 트랜잭션이기 때문에 각 메서드 내에서 에러가 발생하더라도 데이터의 원자성은 유지될 것입니다.
문제는 first<em>transaction() 메서드는 아무 문제 없이 commit 되었는데, second</em>transaction() 메서드에서 예외가 발생했을 때입니다.</p>
<p>이렇게 되면, 첫번째 트랜잭션만 처리가 되고 두번째는 롤백이 됩니다.
의도된 로직이면 아무 문제 없겠지만, 두 트랜잭션 메서드가 하나의 트랜잭션으로 묶여 있어야 하는 상황이라면 엄청난 문제가 발생할 수도 있습니다.
데이터의 원자성을 유지하기 위해서는 first<em>transaction()과 second</em>transaction()을 묶어주는 또다른 트랜잭션을 만들어 줘야 합니다. 위에서는 with transaction.atomic(): 으로 묶어 줬지만, 데코레이터를 써도 상관은 없습니다. 다만, 가장 상위의 메서드가 django 의 view 에 해당하는 경우가 많기 때문에 불필요한 부분까지 같이 묶어주고 싶지 않아서 with 구문을 이용한 것입니다.</p>
<h3 id="결론" style="position:relative;"><a href="#%EA%B2%B0%EB%A1%A0" aria-label="결론 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결론:</h3>
<blockquote>
<ul>
<li>django 트랜잭션은 쉽다.</li>
<li>트랜잭션을 겹쳐서 사용할 경우, 주의해서 사용해야 한다. (반드시 테스트 해볼것!!)</li>
</ul>
</blockquote></div><footer class="sc-AxjAm dWOsdk"><div font-size="15px" class="sc-AxjAm sc-AxirZ blog-post___StyledFlex-sc-13kot0y-1 bcrMFq"><div class="sc-AxjAm erUgeX blog-post___StyledText-sc-13kot0y-2 jSdESJ"><a rel="prev" href="/2015/06/29/remind-of-knou/">난 2년동안 다녔던 방송통신대학에 대한 회고</a></div><div class="sc-AxjAm hTHPLs blog-post___StyledText2-sc-13kot0y-3 gWWQOa"><a rel="next" href="/2016/01/20/shallow-copy-deep-copy/">얕은 복사(shallow copy) vs 깊은 복사(deep copy)</a></div></div><div class="sc-AxjAm gVBYLb"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="5306007932" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div class="sc-AxjAm oDrAC"></div></footer></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-50048807-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2016/01/16/django-migration/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-0ac903aeb5bb8e84f522.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-99ed5caf1e3f27d98142.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9a070ee3a9d62e01018a.js"],"component---src-pages-essay-js":["/component---src-pages-essay-js-1b892ad1e9a84910e233.js"],"component---src-pages-gatsby-js":["/component---src-pages-gatsby-js-98133e24622bd4e39693.js"],"component---src-pages-index-js":["/component---src-pages-index-js-90f0974b078639d281ac.js"],"component---src-pages-interactive-web-js":["/component---src-pages-interactive-web-js-743b3b68ff23f8defecb.js"],"component---src-pages-know-frontend-js":["/component---src-pages-know-frontend-js-624a4a88f4d3b593fbf8.js"],"component---src-pages-programming-js":["/component---src-pages-programming-js-7ca0eac38ef8ea8d23c1.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-823fa17e63d9fec1bd40.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-ea5c8cd6ff2c235c0d08.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-fa2d28419150d7818ac4.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-ea5c8cd6ff2c235c0d08.js" async=""></script><script src="/abd3976e5c27636d99401a91b3294356515814cb-18434863fbd71bfaecce.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-0ac903aeb5bb8e84f522.js" async=""></script><script src="/framework-bd5a53d96a17218f4f08.js" async=""></script><script src="/webpack-runtime-d6f29b461ec6e5e27abd.js" async=""></script></body></html>