<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9821527256079f590f29.css">.container-404{font-family:Arial;height:500vw;-webkit-overflow-scrolling:touch;overflow-x:hidden;display:flex;justify-content:center;align-items:center;position:fixed;left:0;top:0;width:100vw;height:100vh;overflow:hidden;opacity:0;transition:opacity 1s}.container-404>span{padding:1.5vh;font-size:25vh;font-weight:700;color:#333;cursor:default}.container-404>.home{position:fixed;right:3vw;bottom:3vw;margin:0;padding:0;color:#999;cursor:pointer;text-decoration:underline;font-size:13px}abbr,address,article,aside,audio,b,blockquote,body,canvas,cite,code,dd,del,details,dfn,div,dl,dt,em,fieldset,figcaption,figure,footer,form,header,hgroup,html,i,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,p,pre,q,samp,section,small,span,strong,sub,summary,sup,time,ul,var,video{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}iframe,img{width:100%}iframe{margin:20px 0}.adsbygoogle iframe{margin:0}nav ul{list-style:none}blockquote,q{quotes:none}blockquote>p>a{display:inline-block}h1,h2,h3,h4,h5,h6{margin-top:.5em;margin-bottom:.5em;padding-top:1em}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}ins{text-decoration:none}ins,mark{background-color:#fff;color:#000}mark{font-style:italic;font-weight:700}del{text-decoration:line-through}abbr[title],dfn[title]{border-bottom:1px dotted;cursor:help}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}p{margin-bottom:1.8rem}code.language-text{font-size:14px!important}table{margin:40px auto;width:80%;border-spacing:0;border-collapse:collapse}table,table tr{padding:0;border-top:1px solid #ccc}table tr{background-color:#fff;margin:0}table tr:nth-child(2n){background-color:#f8f8f8}table tr th{font-weight:700}table tr td,table tr th{border-bottom:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}table tr td :first-child,table tr th :first-child{margin-top:0}table tr td:not(:first-child),table tr th:not(:first-child){border-left:1px solid #ccc}table tr td :last-child,table tr th :last-child{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.contents a{transition:background .5s}.contents a:not(.gatsby-resp-image-link){color:#3a3a3a;text-decoration:none;border-bottom:3px solid #d7c3ee}.contents a:active:not(.gatsby-resp-image-link),.contents a:hover:not(.gatsby-resp-image-link){outline-width:0;text-shadow:none;background-color:#e0d6eb}.contents ul{margin-left:15px;margin-bottom:1.8rem}.contents ul li a{word-break:break-all}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d;margin-top:.1rem;margin-bottom:1.8rem;border-radius:4px}@media (max-width:600px){pre[class*=language-]{margin-left:-1rem;margin-right:-1rem;font-size:.875rem;border-radius:0}}:not(pre)>code[class*=language-]{background:#dfdfdf;color:#222;padding:3px 5px;font-weight:600}blockquote{margin:20px 15px 20px 0;padding-left:20px;border-left:5px solid #e5e5e5}.frame-wrap{overflow:auto;-webkit-overflow-scrolling:touch;width:100%}#gatsby-noscript{display:none}</style><meta name="generator" content="Gatsby 2.21.33"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><title data-react-helmet="true">[django] 장고 트랜잭션 활용 | bono&#x27;s blog</title><meta data-react-helmet="true" name="google-site-verification" content="R3ZeY1PmaJUY9j_cgNABjesJFgHWVCJpb4TsdfXntMA"/><meta data-react-helmet="true" name="naver-site-verification" content="23eddf7267bb527337927baff11fc26157637f30"/><meta data-react-helmet="true" name="description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:title" content="[django] 장고 트랜잭션 활용"/><meta data-react-helmet="true" property="og:description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creater" content="@blueshw"/><meta data-react-helmet="true" name="twitter:title" content="[django] 장고 트랜잭션 활용"/><meta data-react-helmet="true" name="twitter:description" content="최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 …"/><script data-react-helmet="true" async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script data-react-helmet="true" async="" src="https://static.codepen.io/assets/embed/ei.js"></script><style data-styled="iHZvIS gkRqNh inwzvX jqmIPk lfMCsp iPvBDw gaWkyC jMRudl bCTfZv bWwvzh bZyUGp iMtDsI hXAfHy jzxfFw jDGYoj hTVfqa TbpWH iJLqqc fyQQiZ htELzn jdrydf bAuubi fDhtuB gRKflZ" data-styled-version="4.3.2">
/* sc-component-id: sc-bdVaJa */
.iHZvIS{box-sizing:border-box;}.gkRqNh{box-sizing:border-box;margin-top:50px;}.inwzvX{box-sizing:border-box;margin:10px;}.jqmIPk{box-sizing:border-box;margin-bottom:20px;}.lfMCsp{box-sizing:border-box;margin-bottom:30px;}.iPvBDw{box-sizing:border-box;margin-bottom:40px;}
/* sc-component-id: sc-bwzfXH */
.jDGYoj{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: sc-htpNat */
.TbpWH{box-sizing:border-box;margin-top:15px;margin-bottom:15px;width:100vw;font-size:16px;color:#888888;font-weight:400;text-align:center;}.iJLqqc{box-sizing:border-box;font-size:24px;line-height:1.1;}.fyQQiZ{box-sizing:border-box;margin-top:7px;margin-bottom:70px;color:#bbb;}
/* sc-component-id: menu___StyledLink-h1woa4-0 */
.hTVfqa{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}
/* sc-component-id: header___StyledFlex-sc-1h24lom-0 */
.gaWkyC{box-sizing:border-box;padding:10px;width:100%;background-color:white;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:fixed;left:0;top:0;height:50px;border-bottom:1px solid #e8e8e8;z-index:200;}
/* sc-component-id: header___StyledText-sc-1h24lom-1 */
.jMRudl{box-sizing:border-box;margin-top:3px;margin-left:20px;margin-right:auto;font-size:22px;color:#888888;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;cursor:pointer;} @media (max-width:600px){.jMRudl{margin-left:10px;}}
/* sc-component-id: header___StyledLink-sc-1h24lom-2 */
.bCTfZv{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}
/* sc-component-id: header___StyledBox-sc-1h24lom-3 */
.bWwvzh{box-sizing:border-box;padding:5px;width:30px;height:28px;cursor:pointer;overflow:hidden;}
/* sc-component-id: header___StyledBox2-sc-1h24lom-4 */
.bZyUGp{box-sizing:border-box;margin-bottom:6px;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 0;-ms-transform-origin:100% 0;transform-origin:100% 0;}
/* sc-component-id: header___StyledBox3-sc-1h24lom-5 */
.iMtDsI{box-sizing:border-box;margin-bottom:6px;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:-webkit-transform 0.5s;-webkit-transition:transform 0.5s;transition:transform 0.5s;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin:100% 50%;-ms-transform-origin:100% 50%;transform-origin:100% 50%;}
/* sc-component-id: header___StyledBox4-sc-1h24lom-6 */
.hXAfHy{box-sizing:border-box;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 100%;-ms-transform-origin:100% 100%;transform-origin:100% 100%;}
/* sc-component-id: header___StyledBox5-sc-1h24lom-7 */
.jzxfFw{box-sizing:border-box;width:100%;background-color:white;border-bottom:none;position:fixed;left:0;top:50px;z-index:100;opacity:0.9;max-height:0px;-webkit-transition:max-height 0.5s ease;transition:max-height 0.5s ease;overflow:hidden;}
/* sc-component-id: layout___StyledBox-sc-3234dv-0 */
.htELzn{box-sizing:border-box;margin-left:auto;margin-right:auto;padding:45px 15px;max-width:800px;}
/* sc-component-id: blog-post___StyledBox-sc-13kot0y-0 */
.jdrydf{box-sizing:border-box;color:#333333;line-height:30px;}
/* sc-component-id: blog-post___StyledFlex-sc-13kot0y-1 */
.bAuubi{box-sizing:border-box;margin-bottom:30px;padding-top:30px;font-size:15px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-top:1px solid #eee;}
/* sc-component-id: blog-post___StyledText-sc-13kot0y-2 */
.fDhtuB{box-sizing:border-box;margin-right:5px;line-height:1.8;max-width:280px;}
/* sc-component-id: blog-post___StyledText2-sc-13kot0y-3 */
.gRKflZ{box-sizing:border-box;margin-left:5px;text-align:right;line-height:1.8;max-width:280px;}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-2a70fb92edaaa900d87e.js"/><link as="script" rel="preload" href="/framework-8239e68d64ca24dc577f.js"/><link as="script" rel="preload" href="/app-d3e890de1df7246c3506.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/ec56ea7fc1ab969d448a8b0cbe19e123f99d0282-cb9bdd9c98b52c590d23.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-a555560c570baa59f813.js"/><link as="fetch" rel="preload" href="/page-data/2016/01/16/django-migration/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-bdVaJa iHZvIS"><div class="sc-bdVaJa iHZvIS"><header width="100%" class="sc-bdVaJa sc-bwzfXH header___StyledFlex-sc-1h24lom-0 gaWkyC"><div color="grey01" font-size="22px" class="sc-bdVaJa sc-htpNat header___StyledText-sc-1h24lom-1 jMRudl"><a class="header___StyledLink-sc-1h24lom-2 bCTfZv" href="/">bono&#x27;s blog</a></div><div width="30px" class="sc-bdVaJa header___StyledBox-sc-1h24lom-3 bWwvzh"><div width="20px" class="sc-bdVaJa header___StyledBox2-sc-1h24lom-4 bZyUGp"></div><div width="20px" class="sc-bdVaJa header___StyledBox3-sc-1h24lom-5 iMtDsI"></div><div width="20px" class="sc-bdVaJa header___StyledBox4-sc-1h24lom-6 hXAfHy"></div></div></header><div class="sc-bdVaJa gkRqNh"></div><nav width="100%" class="sc-bdVaJa header___StyledBox5-sc-1h24lom-7 jzxfFw"><ul class="sc-bdVaJa inwzvX"><div class="sc-bdVaJa sc-bwzfXH jDGYoj"><li class="sc-bdVaJa iHZvIS"><a class="menu___StyledLink-h1woa4-0 hTVfqa" href="/programming"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-bdVaJa sc-htpNat TbpWH">개발</div></a></li></div><div class="sc-bdVaJa sc-bwzfXH jDGYoj"><li class="sc-bdVaJa iHZvIS"><a class="menu___StyledLink-h1woa4-0 hTVfqa" href="/interactive-web"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-bdVaJa sc-htpNat TbpWH">인터랙티브웹</div></a></li></div><div class="sc-bdVaJa sc-bwzfXH jDGYoj"><li class="sc-bdVaJa iHZvIS"><a class="menu___StyledLink-h1woa4-0 hTVfqa" href="/essay"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-bdVaJa sc-htpNat TbpWH">에세이</div></a></li></div><div class="sc-bdVaJa sc-bwzfXH jDGYoj"><li class="sc-bdVaJa iHZvIS"><a class="menu___StyledLink-h1woa4-0 hTVfqa" href="/review"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-bdVaJa sc-htpNat TbpWH">책리뷰</div></a></li></div><div class="sc-bdVaJa sc-bwzfXH jDGYoj"><li class="sc-bdVaJa iHZvIS"><a class="menu___StyledLink-h1woa4-0 hTVfqa" href="/tags"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-bdVaJa sc-htpNat TbpWH">태그</div></a></li></div></ul></nav></div><main class="sc-bdVaJa contents layout___StyledBox-sc-3234dv-0 htELzn"><div font-size="24px" class="sc-bdVaJa sc-htpNat iJLqqc">[django] 장고 트랜잭션 활용</div><div color="#bbb" class="sc-bdVaJa sc-htpNat fyQQiZ">January 16, 2016</div><div class="sc-bdVaJa jqmIPk"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="1331884154" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div color="text" class="sc-bdVaJa blog-post___StyledBox-sc-13kot0y-0 jdrydf"><p>최근에 python + django 로 프로젝트를 진행하고 있습니다. 두달전부터 시작했으니 아직은 python, django 모두 초보라 할 수 있겠죠. 프로젝트를 같이 진행하는 동료들도 저 처럼 거의 저와 비슷한 상황입니다. 그러다보니 프로젝트를 진행하면서 막히는 부분이 생길때마다 검색을 해보거나 파이썬 콘솔을 이용하여 검증, 또는 소스를 뜯어보며 작동원리를 파악하곤 합니다. 이 삽질과도 같은 수많은 과정들이 한순간에 끝나버리는게 아쉬워 블로그에 남겨보기로 결정했습니다. 시간이 남아돌아 글을 쓰는것은 아니지만, 글을 쓰는 행위는 어렴풋이 이해하고 있는 것들을 확실히 나의 지식으로 만드는 최고의 방법이라 생각하기에 시간을 쪼개서 지속해 나갈 생각입니다. 여러가지 부분을 다루겠지만, 체계 따위는 없습니다. 그때 그때 떠오르는 것, 또는 프로젝트 진행중에 특정부분이 막혀 정리가 필요한 시점에는 그 부분을 다루려고 합니다.</p>
<p>첫번째는 트랜잭션(transaction)입니다. 트랜잭션이 뭐냐고 물었을때 대부분의 프로그래머가 잘 알고 있을거라 생각합니다. 간단히 말해 작업 단위라 할 수 있는데, 여러개의 프로세스가 묶여져 마치 하나처럼 동작하는 방식이라 할 수 있겠습니다. 그렇기 때문에 성공 아니면 실패 두가지 결과밖에 존재하지 않겠죠. 좀더 개발적(?)인 언어로는 이렇게 말할수도 있습니다. 데이터베이스를 저장하고 수정하는 여러 작업을 하나의 쿼리로 처리할 수 없기 때문에 여러개의 쿼리로 나눠서 실행해야 하는데, 그 결과의 원자성을 보장해주기 위해 동일한 DB connection 객체를 사용하는 기술이라 할 수 있습니다. 자세한 내용은 직접 검색해 보시기 바랍니다.</p>
<blockquote>
<p><em>django 는 1.8.5 버전을 사용하였고, python 은 3.4.3 버전을 사용하였습니다.</em></p>
</blockquote>
<h3>1. 데코레이터(decorator)를 이용한 python + django 트랜잭션</h3>
<p>django 에서 트랜잭션을 이용하는 가장 쉬운 방법으로 데코레이터를 이용하는 방법입니다.
데코레이터를 이용하게 되면, 메서드 안에는 코드를 삽입할 필요가 없습니다.
“@transaction.atomic” 이라는 데코레이터를 붙여주기만 하면 끝입니다.
django 에서 기본적으로 제공해주는 데코레이터이므로, 따로 모듈을 설치해줄 필요도 없습니다.</p>
<p>가장 간단하게 atomic(원자성)한 트랜잭션을 처리하기 위한 손쉬운 방법이죠.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

@transaction<span class="token punctuation">.</span>atomic
<span class="token keyword">def</span> <span class="token function">transaction_test1</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># start transaction</span>
    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># end transaction</span></code></pre></div>
<h3>2. with 명령어를 이용한 트랜잭션</h3>
<p>메서드 전체가 아닌 메서드의 일부분만 트랜잭션으로 묶어줄 필요가 있을 때 사용합니다.
트랜잭션으로 묶일 부분을 직접 지정해줘야 하는 불편함(?)이 있지만, 데코레이터와 마찬가지로 비교적 간단하게 처리가 가능합니다.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">transaction_test2</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 항상 save 처리됨, 예외가 발생할 경우 에러 발생</span>

    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># start transaction</span>
        b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># end transaction</span></code></pre></div>
<h3>3. savepoint 를 직접 지정해 주는 트랜잭션</h3>
<p>1 번과 2 번의 방법의 경우, 메서드 내에서(트랜잭션으로 묶여져있는) exception 이 발생하더라도 저절로 롤백이 되기 때문에 예외처리를 따로 해 줄 필요는 없습니다.
하지만, 3 번의 경우에는 savepoint 및 cummit 지점을 직접 지정해 주기 때문에 예외처리 또한 별도로 처리되어야 합니다.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">transaction_test3</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sid <span class="token operator">=</span> transaction<span class="token punctuation">.</span>savepoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># start transaction</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>

        b<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        c<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        transaction<span class="token punctuation">.</span>savepoint_commit<span class="token punctuation">(</span>sid<span class="token punctuation">)</span>
        <span class="token comment"># end transaction</span>
    <span class="token keyword">except</span> Exception
        <span class="token comment"># 트랜잭션 내에서 에러 발생시 롤백처리</span>
        transaction<span class="token punctuation">.</span>savepoint_rollback<span class="token punctuation">(</span>sid<span class="token punctuation">)</span></code></pre></div>
<p>위의 세가지가 django 에서 트랜잭션을 처리하는 방법입니다. 간단한 트랜잭션 함수를 호출할 때는 위의 세가지 중에 알맞은 방법을 선택해서 처리하면 되겠습니다. 좀 더 복잡한 상황을 한번 살펴보도록 하죠.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> transaction

<span class="token keyword">def</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># 첫번째 트랜잭션 메서드</span>
        first_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 두번째 트랜잭션 메서드</span>
        second_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span>


@transaction<span class="token punctuation">.</span>atomic
<span class="token keyword">def</span> <span class="token function">first_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    a<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

    b<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>


@transaction<span class="token punctuation">.</span>atomic
<span class="token keyword">def</span> <span class="token function">second_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    c<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

    d<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>위의 경우에는 트랜잭션 메서드 두개를 묶어서 또다른 트랜잭션을 구성하였습니다.
각각의 메서드는 독자적읜 트랜잭션이기 때문에 각 메서드 내에서 에러가 발생하더라도 데이터의 원자성은 유지될 것입니다.
문제는 first<em>transaction() 메서드는 아무 문제 없이 commit 되었는데, second</em>transaction() 메서드에서 예외가 발생했을 때입니다.</p>
<p>이렇게 되면, 첫번째 트랜잭션만 처리가 되고 두번째는 롤백이 됩니다.
의도된 로직이면 아무 문제 없겠지만, 두 트랜잭션 메서드가 하나의 트랜잭션으로 묶여 있어야 하는 상황이라면 엄청난 문제가 발생할 수도 있습니다.
데이터의 원자성을 유지하기 위해서는 first<em>transaction()과 second</em>transaction()을 묶어주는 또다른 트랜잭션을 만들어 줘야 합니다. 위에서는 with transaction.atomic(): 으로 묶어 줬지만, 데코레이터를 써도 상관은 없습니다. 다만, 가장 상위의 메서드가 django 의 view 에 해당하는 경우가 많기 때문에 불필요한 부분까지 같이 묶어주고 싶지 않아서 with 구문을 이용한 것입니다.</p>
<h3>결론:</h3>
<blockquote>
<ul>
<li>django 트랜잭션은 쉽다.</li>
<li>트랜잭션을 겹쳐서 사용할 경우, 주의해서 사용해야 한다. (반드시 테스트 해볼것!!)</li>
</ul>
</blockquote></div><div class="sc-bdVaJa lfMCsp"></div><div font-size="15px" class="sc-bdVaJa sc-bwzfXH blog-post___StyledFlex-sc-13kot0y-1 bAuubi"><div class="sc-bdVaJa sc-htpNat blog-post___StyledText-sc-13kot0y-2 fDhtuB"><a rel="prev" href="/2015/06/29/remind-of-knou/">난 2년동안 다녔던 방송통신대학에 대한 회고</a></div><div class="sc-bdVaJa sc-htpNat blog-post___StyledText2-sc-13kot0y-3 gRKflZ"><a rel="next" href="/2016/01/20/shallow-copy-deep-copy/">얕은 복사(shallow copy) vs 깊은 복사(deep copy)</a></div></div><div class="sc-bdVaJa iPvBDw"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="5306007932" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div id="disqus_thread"></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-50048807-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2016/01/16/django-migration/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d3e890de1df7246c3506.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-a280e1b1a70cffe6109c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9a070ee3a9d62e01018a.js"],"component---src-pages-essay-js":["/component---src-pages-essay-js-8c87f736406a19399689.js"],"component---src-pages-index-js":["/component---src-pages-index-js-66e859c60b4fbd895120.js"],"component---src-pages-interactive-web-js":["/component---src-pages-interactive-web-js-2eeccbf3f70f15aec732.js"],"component---src-pages-programming-js":["/component---src-pages-programming-js-bd2ea0a04ac30a1654aa.js"],"component---src-pages-review-js":["/component---src-pages-review-js-a0fe9145cd0698e7cea1.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-d3957ee27c9ad7580939.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-a555560c570baa59f813.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-181498035a73074edbe5.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-a555560c570baa59f813.js" async=""></script><script src="/ec56ea7fc1ab969d448a8b0cbe19e123f99d0282-cb9bdd9c98b52c590d23.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-d3e890de1df7246c3506.js" async=""></script><script src="/framework-8239e68d64ca24dc577f.js" async=""></script><script src="/webpack-runtime-2a70fb92edaaa900d87e.js" async=""></script></body></html>