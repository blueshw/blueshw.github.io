<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="R3ZeY1PmaJUY9j_cgNABjesJFgHWVCJpb4TsdfXntMA"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=""><meta name="keyword" content=""><link rel="shortcut icon" href="/img/favicon2.ico"><link rel="canonical" href="http://blueshw.github.io/2018/03/25/priority-css-selector/"><title>[CSS] styled-jsx 버그 보고 경험기 (사실은 stylus 버그) - 보노의블로그 | Bono&#39;s Blog</title><link rel="canonical" href="http://blueshw.github.io/2018/03/25/priority-css-selector/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/hux-blog.css"><link rel="stylesheet" href="/css/highlight.css"><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><script></script></head><body ontouchstart=""><nav class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">보노의 블로그</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/archives/">Archives</a></li><li><a href="/tags/">Tags</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><style type="text/css"></style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><div class="tags"><a class="tag" href="/tags/#css" title="css">css</a> <a class="tag" href="/tags/#css selector" title="css selector">css selector</a> <a class="tag" href="/tags/#github" title="github">github</a> <a class="tag" href="/tags/#styled-jsx" title="styled-jsx">styled-jsx</a> <a class="tag" href="/tags/#stylis" title="stylis">stylis</a></div><h1>[CSS] styled-jsx 버그 보고 경험기 (사실은 stylus 버그)</h1><h2 class="subheading"></h2><span class="meta">Posted by bono on 2018-03-25</span></div></div></div></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><p>CSS는 일련의 가중치에 따라서 어떤 속성을 우선적으로 적용할 것인지 결정합니다. 우선순위에 대한 정보는 조금만 검색해보면 나오므로 간단히 <a href="https://gist.github.com/mjj2000/5873872" rel="external nofollow noopener noreferrer" target="_blank">링크</a>로 대체합니다.</p><p>현재 회사에서는 <a href="(https://github.com/zeit/next.js/">nextjs</a>를 사용한 프로젝트를 진행하고 있습니다. nextjs는 서버사이드렌더링(SSR)을 지원하는 리액트 전용 프레임워크입니다. <a href="https://github.com/facebook/create-react-app" rel="external nofollow noopener noreferrer" target="_blank">create-react-app</a>처럼 <code>non-configuration</code>을 지향하며 create-react-app과는 다르게 일부 설정을 수정할 수 있습니다. nextjs는 내부적으로 다양한 라이브러리들이 사용되고 있는데, react 컴포넌트(jsx)에서 CSS 코드를 작성하기 위해서 <a href="https://github.com/zeit/styled-jsx" rel="external nofollow noopener noreferrer" target="_blank">styled-jsx</a>를 사용합니다.</p><p>styled-jsx는 서버와 클라이언트에서 모두 사용가능하고, 컴포넌트별 scope를 지원합니다. 컴포넌트 scope를 지원하기 위한 방법으로 <code>.jsx-xxxxxxxx</code>과 같은 클래스를 css 정의 요소에 붙여주는데요. 덕분에 대체로 아주 편리하게 사용하고 있었지만, 최근 한 가지 문제점을 발견했습니다.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;<span class="selector-tag">span</span> className=<span class="string">"title"</span>&gt;빨간색으로 나와야 할텐데..&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;style jsx&gt;&#123;`</span><br><span class="line">  <span class="selector-tag">div</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">`&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>&lt;span&gt;</code>의 텍스트에 색상을 입히는 스타일이 두가지가 있습니다. 위쪽은 <code>div &gt; div &gt; span</code>처럼 element의 cascade 형태로 정의하고, 아래쪽은 class 이름으로 정의합니다. class가 10점이라고 하면 element는 개당 1점이므로 <code>.title</code>의 가중치가 높아 <code>red</code> 색상의 텍스트가 출력되어야 합니다. 하지만, 결과는 아래와 같았습니다.</p><p><span style="color:#00f">빨간색으로 나와야 할텐데..</span></p><p>우리가 익히 알고 있는 css 선택자는 <code>class</code>가 <code>element</code> 보다 명시도(가중치 또는 우선순위)가 높습니다. 위에서 언급한것처럼 element가 1점이라면 class는 10점으로 평가되기 때문입니다. 위의 CSS 코드에 점수를 매겨보면, 첫번째 스타일은 3점이고 두번째 스타일은 10점이 됩니다.</p><table><thead><tr><th style="text-align:center">css</th><th style="text-align:center">specificity(명시도)</th></tr></thead><tbody><tr><td style="text-align:center">div&gt;div&gt;span</td><td style="text-align:center">0 0 0 3</td></tr><tr><td style="text-align:center">.title</td><td style="text-align:center">0 0 1 0</td></tr></tbody></table><p>그런데 styled-jsx(<code>v2.2.x</code> 사용)를 통해서 컴파일이 완료되면 실제 명시도는 아래처럼 변경됩니다.</p><table><thead><tr><th style="text-align:center">css</th><th style="text-align:center">specificity(명시도)</th></tr></thead><tbody><tr><td style="text-align:center">div.jsx-1234&gt;div.jsx-1234&gt;span.jsx-1234</td><td style="text-align:center">0 0 3 3</td></tr><tr><td style="text-align:center">.title.jsx-1234</td><td style="text-align:center">0 0 2 0</td></tr></tbody></table><p>첫번째 스타일이 두번째 스타일보다 명시도가 높게 변했습니다. 원래 기대했던 것과는 전혀 다른 결과가 나왔네요. 사용법에 문제가 있었던 것인지, 아니면 이미 보고된 버그인지 확인하기 위해 styled-jsx github 페이지의 이슈를 검색해보았지만, 마땅한 버그를 찾을 수 없었습니다. 그래서 제가 <a href="https://github.com/zeit/styled-jsx/issues/424" rel="external nofollow noopener noreferrer" target="_blank">버그</a> 보고했습니다.</p><p>하루가 지나니 짜잔!!<br><code>bug</code>로 등록되었습니다!!!</p><img src="/2018/03/25/priority-css-selector/bug.png"><p>쓰레드에 달린 글을 보니 styled-jsx에서 사용하는 <code>stylis</code>가 문제였습니다. stylis는 컴포넌트별 scope를 만들기 위해 id, class, element에 특정 해시(styled-jsx의 경우 <code>jsx-1234</code>)class를 붙여주는데, 가중치에 상관없이 모든 요소(id, class, element)에 class를 붙여주다보니 결과적으로 원하지 않는 결과가 나온 것입니다. 이 문제에 대해서 곰곰히 생각해보았더니, 지금처럼 모든 요소에 해시class를 붙여줄것이 아니라 각 CSS 선택자마다 하나의 class만 붙여주면 해결될것 같은 느낌이 들었습니다.</p><p>첫 element에만 class를 붙이거나,</p><table><thead><tr><th style="text-align:center">css</th><th style="text-align:center">specificity(명시도)</th></tr></thead><tbody><tr><td style="text-align:center">div.jsx-1234&gt;div&gt;span</td><td style="text-align:center">0 0 1 3</td></tr><tr><td style="text-align:center">.title.jsx-1234</td><td style="text-align:center">0 0 2 0</td></tr></tbody></table><p>마지막 element에 class를 붙이는식으로 처리하는 것입니다.</p><table><thead><tr><th style="text-align:center">css</th><th style="text-align:center">specificity(명시도)</th></tr></thead><tbody><tr><td style="text-align:center">div&gt;div&gt;span.jsx-1234</td><td style="text-align:center">0 0 1 3</td></tr><tr><td style="text-align:center">.title.jsx-1234</td><td style="text-align:center">0 0 2 0</td></tr></tbody></table><p>모든 케이스를 고려해 보지 않았지만, 이런 방식으로 처리하면 문제가 해결될 것이라고 생각되어, 제가 보고했던 버그 스레드에 <a href="https://github.com/zeit/styled-jsx/issues/424#issuecomment-375518440" rel="external nofollow noopener noreferrer" target="_blank">댓글</a>을 달았습니다. 그랬더니, 와!!</p><img src="/2018/03/25/priority-css-selector/answer.png"><p>이후로 <code>stylis</code> <a href="https://github.com/thysultan/stylis.js/issues/101" rel="external nofollow noopener noreferrer" target="_blank">이슈</a> 에서 해결방안이 활발히 논의되고 있습니다(맨 앞 요소와 맨 뒤 요소에 `jsx-1234를 붙여주는걸로 가닥을 잡은 것 같습니다). 제가 직접 코드를 기여하지 않았습니다만, 제 의견이 반영되니 묘한 기분이 들더군요. 지금껏 오픈소스에 기여한적이 없었기 때문에 그랬는지도 모르겠습니다. 다들 이 맛에 오픈소스 하는구나라는 생각이 드는 경험이었습니다.</p><h4 id="참고자료"><a href="#참고자료" class="headerlink" title="참고자료"></a>참고자료</h4><ul><li><a href="https://gist.github.com/mjj2000/5873872" rel="external nofollow noopener noreferrer" target="_blank">https://gist.github.com/mjj2000/5873872</a></li><li><a href="https://developer.mozilla.org/ko/docs/Web/CSS/Specificity" rel="external nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ko/docs/Web/CSS/Specificity</a></li></ul><hr><ul class="pager"><li class="next"><a href="/2018/03/21/function-test-with-jest/" data-toggle="tooltip" data-placement="top" title="[Jest] mock 함수를 이용하여 함수 호출 테스트 하기">Next Post &rarr;</a></li></ul><div class="comment"><div id="disqus_thread" class="disqus-thread"></div></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><section><h5><a href="/tags/">FEATURED TAGS</a></h5><div class="tags"><a class="tag" href="/tags/#css" title="css">css</a> <a class="tag" href="/tags/#css selector" title="css selector">css selector</a> <a class="tag" href="/tags/#github" title="github">github</a> <a class="tag" href="/tags/#styled-jsx" title="styled-jsx">styled-jsx</a> <a class="tag" href="/tags/#stylis" title="stylis">stylis</a></div></section></div></div></div></article><script type="text/javascript">var disqus_shortname="bonogithub",disqus_identifier="http://blueshw.github.io/2018/03/25/priority-css-selector/",disqus_url="http://blueshw.github.io/2018/03/25/priority-css-selector/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target="_blank" href="https://twitter.com/blueshw" rel="external nofollow noopener noreferrer"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://www.facebook.com/blueshw" rel="external nofollow noopener noreferrer"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://github.com/blueshw" rel="external nofollow noopener noreferrer"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 보노의 블로그 2018</p></div></div></div></footer><script src="/js/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/hux-blog.min.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>0!==$("#tag_cloud").length&&async("http://blueshw.github.io/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _gaId="UA-50048807-2",_gaDomain="blueshw.github.io";!function(a,e,g,n,t,o,c){a.GoogleAnalyticsObject="ga",a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,o=e.createElement(g),c=e.getElementsByTagName(g)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(o,c)}(window,document,"script"),ga("create",_gaId,_gaDomain),ga("send","pageview")</script><img src="http://blueshw.github.io/img/icon_wechat.png" width="0" height="0"></body></html>