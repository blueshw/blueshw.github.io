<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9821527256079f590f29.css">.container-404{font-family:Arial;height:500vw;-webkit-overflow-scrolling:touch;overflow-x:hidden;display:flex;justify-content:center;align-items:center;position:fixed;left:0;top:0;width:100vw;height:100vh;overflow:hidden;opacity:0;transition:opacity 1s}.container-404>span{padding:1.5vh;font-size:25vh;font-weight:700;color:#333;cursor:default}.container-404>.home{position:fixed;right:3vw;bottom:3vw;margin:0;padding:0;color:#999;cursor:pointer;text-decoration:underline;font-size:13px}abbr,address,article,aside,audio,b,blockquote,body,canvas,cite,code,dd,del,details,dfn,div,dl,dt,em,fieldset,figcaption,figure,footer,form,header,hgroup,html,i,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,p,pre,q,samp,section,small,span,strong,sub,summary,sup,time,ul,var,video{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}iframe,img{width:100%}iframe{margin:20px 0}.adsbygoogle iframe{margin:0}nav ul{list-style:none}blockquote,q{quotes:none}blockquote>p>a{display:inline-block}h1,h2,h3,h4,h5,h6{margin-top:.5em;margin-bottom:.5em;padding-top:1em}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}ins{text-decoration:none}ins,mark{background-color:#fff;color:#000}mark{font-style:italic;font-weight:700}del{text-decoration:line-through}abbr[title],dfn[title]{border-bottom:1px dotted;cursor:help}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}p{margin-bottom:1.8rem}code.language-text{font-size:14px!important}table{margin:40px auto;width:80%;border-spacing:0;border-collapse:collapse}table,table tr{padding:0;border-top:1px solid #ccc}table tr{background-color:#fff;margin:0}table tr:nth-child(2n){background-color:#f8f8f8}table tr th{font-weight:700}table tr td,table tr th{border-bottom:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}table tr td :first-child,table tr th :first-child{margin-top:0}table tr td:not(:first-child),table tr th:not(:first-child){border-left:1px solid #ccc}table tr td :last-child,table tr th :last-child{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.contents a{transition:background .5s}.contents a:not(.gatsby-resp-image-link){color:#3a3a3a;text-decoration:none;border-bottom:3px solid #d7c3ee}.contents a:active:not(.gatsby-resp-image-link),.contents a:hover:not(.gatsby-resp-image-link){outline-width:0;text-shadow:none;background-color:#e0d6eb}.contents ul{margin-left:15px;margin-bottom:1.8rem}.contents ul li a{word-break:break-all}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d;margin-top:.1rem;margin-bottom:1.8rem;border-radius:4px}@media (max-width:600px){pre[class*=language-]{margin-left:-1rem;margin-right:-1rem;font-size:.875rem;border-radius:0}}:not(pre)>code[class*=language-]{background:#dfdfdf;color:#222;padding:3px 5px;font-weight:600}blockquote{margin:20px 15px 20px 0;padding-left:20px;border-left:5px solid #e5e5e5}.frame-wrap{overflow:auto;-webkit-overflow-scrolling:touch;width:100%}#gatsby-noscript{display:none}</style><meta name="generator" content="Gatsby 2.21.33"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=edf3d310d67f8284a562bc3a58c3e761"/><title data-react-helmet="true">modal(popup) 에서 외부(body or parentElement) 스크롤 막기 | bono&#x27;s blog</title><link data-react-helmet="true" rel="canonical" href="/2019/04/24/prevent-scroll-outside/"/><meta data-react-helmet="true" name="google-site-verification" content="R3ZeY1PmaJUY9j_cgNABjesJFgHWVCJpb4TsdfXntMA"/><meta data-react-helmet="true" name="naver-site-verification" content="23eddf7267bb527337927baff11fc26157637f30"/><meta data-react-helmet="true" name="description" content="react에서 modal 뷰 구현을 위해 react-modal 패키지를 사용한다. 근데 이 react-modal을 쓰다보면 한가지 문제에 부딪힌다. 바로 모달 외부의 dimmed 영역이 스크롤되는 문제다. 예제를 살펴보자 (모바일이라면 반드시 새창으…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:title" content="modal(popup) 에서 외부(body or parentElement) 스크롤 막기"/><meta data-react-helmet="true" property="og:description" content="react에서 modal 뷰 구현을 위해 react-modal 패키지를 사용한다. 근데 이 react-modal을 쓰다보면 한가지 문제에 부딪힌다. 바로 모달 외부의 dimmed 영역이 스크롤되는 문제다. 예제를 살펴보자 (모바일이라면 반드시 새창으…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creater" content="@blueshw"/><meta data-react-helmet="true" name="twitter:title" content="modal(popup) 에서 외부(body or parentElement) 스크롤 막기"/><meta data-react-helmet="true" name="twitter:description" content="react에서 modal 뷰 구현을 위해 react-modal 패키지를 사용한다. 근데 이 react-modal을 쓰다보면 한가지 문제에 부딪힌다. 바로 모달 외부의 dimmed 영역이 스크롤되는 문제다. 예제를 살펴보자 (모바일이라면 반드시 새창으…"/><script data-react-helmet="true" async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script data-react-helmet="true" async="" src="https://static.codepen.io/assets/embed/ei.js"></script><style data-styled="" data-styled-version="5.1.0">.eVGsRt{box-sizing:border-box;}/*!sc*/
.cbOCKl{box-sizing:border-box;margin-top:50px;}/*!sc*/
.ehbqUb{box-sizing:border-box;margin:10px;}/*!sc*/
.iJkThC{box-sizing:border-box;margin-bottom:20px;}/*!sc*/
.cJBtFD{box-sizing:border-box;margin-bottom:30px;}/*!sc*/
.dvqQYw{box-sizing:border-box;margin-bottom:40px;}/*!sc*/
data-styled.g1[id="sc-AxjAm"]{content:"eVGsRt,cbOCKl,ehbqUb,iJkThC,cJBtFD,dvqQYw,"}/*!sc*/
.gyCFqX{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g2[id="sc-AxirZ"]{content:"gyCFqX,"}/*!sc*/
.jfpngD{box-sizing:border-box;margin-top:15px;margin-bottom:15px;width:100vw;font-size:16px;color:#888888;font-weight:400;text-align:center;}/*!sc*/
.fRqRnt{box-sizing:border-box;font-size:24px;line-height:1.1;}/*!sc*/
.JClXL{box-sizing:border-box;margin-top:7px;margin-bottom:70px;color:#bbb;}/*!sc*/
data-styled.g3[id="sc-AxiKw"]{content:"jfpngD,fRqRnt,JClXL,"}/*!sc*/
.hDyThI{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g9[id="menu___StyledLink-h1woa4-0"]{content:"hDyThI,"}/*!sc*/
.Amqne{box-sizing:border-box;padding:10px;width:100%;background-color:white;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:fixed;left:0;top:0;height:50px;border-bottom:1px solid #e8e8e8;z-index:200;}/*!sc*/
data-styled.g10[id="header___StyledFlex-sc-1h24lom-0"]{content:"Amqne,"}/*!sc*/
.kcEQRU{box-sizing:border-box;margin-top:3px;margin-left:20px;margin-right:auto;font-size:22px;color:#888888;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;cursor:pointer;}/*!sc*/
@media (max-width:600px){.kcEQRU{margin-left:10px;}}/*!sc*/
data-styled.g11[id="header___StyledText-sc-1h24lom-1"]{content:"kcEQRU,"}/*!sc*/
.hUslui{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g12[id="header___StyledLink-sc-1h24lom-2"]{content:"hUslui,"}/*!sc*/
.hNgKL{box-sizing:border-box;padding:5px;width:30px;height:28px;cursor:pointer;overflow:hidden;}/*!sc*/
data-styled.g13[id="header___StyledBox-sc-1h24lom-3"]{content:"hNgKL,"}/*!sc*/
.lflpdZ{box-sizing:border-box;margin-bottom:6px;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 0;-ms-transform-origin:100% 0;transform-origin:100% 0;}/*!sc*/
data-styled.g14[id="header___StyledBox2-sc-1h24lom-4"]{content:"lflpdZ,"}/*!sc*/
.bMDFrv{box-sizing:border-box;margin-bottom:6px;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:-webkit-transform 0.5s;-webkit-transition:transform 0.5s;transition:transform 0.5s;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin:100% 50%;-ms-transform-origin:100% 50%;transform-origin:100% 50%;}/*!sc*/
data-styled.g15[id="header___StyledBox3-sc-1h24lom-5"]{content:"bMDFrv,"}/*!sc*/
.eyaNHy{box-sizing:border-box;padding-top:2px;width:20px;background-color:#888888;-webkit-transition:all 0.4s;transition:all 0.4s;-webkit-transform:rotateZ(0);-ms-transform:rotateZ(0);transform:rotateZ(0);-webkit-transform-origin:100% 100%;-ms-transform-origin:100% 100%;transform-origin:100% 100%;}/*!sc*/
data-styled.g16[id="header___StyledBox4-sc-1h24lom-6"]{content:"eyaNHy,"}/*!sc*/
.bSjiBb{box-sizing:border-box;width:100%;background-color:white;border-bottom:none;position:fixed;left:0;top:50px;z-index:100;opacity:0.9;max-height:0px;-webkit-transition:max-height 0.5s ease;transition:max-height 0.5s ease;overflow:hidden;}/*!sc*/
data-styled.g17[id="header___StyledBox5-sc-1h24lom-7"]{content:"bSjiBb,"}/*!sc*/
.djLIMH{box-sizing:border-box;margin-left:auto;margin-right:auto;padding:45px 15px;max-width:800px;}/*!sc*/
data-styled.g18[id="layout___StyledBox-sc-3234dv-0"]{content:"djLIMH,"}/*!sc*/
.fBAtY{box-sizing:border-box;color:#333333;line-height:30px;}/*!sc*/
data-styled.g25[id="blog-post___StyledBox-sc-13kot0y-0"]{content:"fBAtY,"}/*!sc*/
.hSJHkQ{box-sizing:border-box;margin-bottom:30px;padding-top:30px;font-size:15px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-top:1px solid #eee;}/*!sc*/
data-styled.g26[id="blog-post___StyledFlex-sc-13kot0y-1"]{content:"hSJHkQ,"}/*!sc*/
.kiTuVM{box-sizing:border-box;margin-right:5px;line-height:1.8;max-width:280px;}/*!sc*/
data-styled.g27[id="blog-post___StyledText-sc-13kot0y-2"]{content:"kiTuVM,"}/*!sc*/
.dUhyew{box-sizing:border-box;margin-left:5px;text-align:right;line-height:1.8;max-width:280px;}/*!sc*/
data-styled.g28[id="blog-post___StyledText2-sc-13kot0y-3"]{content:"dUhyew,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-d39a85d387998099c779.js"/><link as="script" rel="preload" href="/framework-c034a59c69769c9f4a47.js"/><link as="script" rel="preload" href="/app-11b3c027aedda7ebd9e8.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/ec56ea7fc1ab969d448a8b0cbe19e123f99d0282-3a99fceca4bc424f3755.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f2689ed479cfe464a093.js"/><link as="fetch" rel="preload" href="/page-data/2019/04/24/prevent-scroll-outside/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-AxjAm eVGsRt"><div class="sc-AxjAm eVGsRt"><header width="100%" class="sc-AxjAm sc-AxirZ header___StyledFlex-sc-1h24lom-0 Amqne"><div color="grey01" font-size="22px" class="sc-AxjAm sc-AxiKw header___StyledText-sc-1h24lom-1 kcEQRU"><a class="header___StyledLink-sc-1h24lom-2 hUslui" href="/">bono&#x27;s blog</a></div><div width="30px" class="sc-AxjAm header___StyledBox-sc-1h24lom-3 hNgKL"><div width="20px" class="sc-AxjAm header___StyledBox2-sc-1h24lom-4 lflpdZ"></div><div width="20px" class="sc-AxjAm header___StyledBox3-sc-1h24lom-5 bMDFrv"></div><div width="20px" class="sc-AxjAm header___StyledBox4-sc-1h24lom-6 eyaNHy"></div></div></header><div class="sc-AxjAm cbOCKl"></div><nav width="100%" class="sc-AxjAm header___StyledBox5-sc-1h24lom-7 bSjiBb"><ul class="sc-AxjAm ehbqUb"><div class="sc-AxjAm sc-AxirZ gyCFqX"><li class="sc-AxjAm eVGsRt"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/programming"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-AxjAm sc-AxiKw jfpngD">개발</div></a></li></div><div class="sc-AxjAm sc-AxirZ gyCFqX"><li class="sc-AxjAm eVGsRt"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/interactive-web"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-AxjAm sc-AxiKw jfpngD">인터랙티브웹</div></a></li></div><div class="sc-AxjAm sc-AxirZ gyCFqX"><li class="sc-AxjAm eVGsRt"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/essay"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-AxjAm sc-AxiKw jfpngD">에세이</div></a></li></div><div class="sc-AxjAm sc-AxirZ gyCFqX"><li class="sc-AxjAm eVGsRt"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/review"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-AxjAm sc-AxiKw jfpngD">책리뷰</div></a></li></div><div class="sc-AxjAm sc-AxirZ gyCFqX"><li class="sc-AxjAm eVGsRt"><a class="menu___StyledLink-h1woa4-0 hDyThI" href="/tags"><div width="100vw" font-size="16px" font-weight="400" color="#888888" class="sc-AxjAm sc-AxiKw jfpngD">태그</div></a></li></div></ul></nav></div><main class="sc-AxjAm layout___StyledBox-sc-3234dv-0 djLIMH contents"><div font-size="24px" class="sc-AxjAm sc-AxiKw fRqRnt">modal(popup) 에서 외부(body or parentElement) 스크롤 막기</div><div color="#bbb" class="sc-AxjAm sc-AxiKw JClXL">April 25, 2019</div><div class="sc-AxjAm iJkThC"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="1331884154" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div color="text" class="sc-AxjAm blog-post___StyledBox-sc-13kot0y-0 fBAtY"><p>react에서 modal 뷰 구현을 위해 react-modal 패키지를 사용한다. 근데 이 react-modal을 쓰다보면 한가지 문제에 부딪힌다. 바로 모달 외부의 dimmed 영역이 스크롤되는 문제다. 예제를 살펴보자 (모바일이라면 반드시 새창으로 열어서 확인하자). </p>
<div class="frame-wrap">
<iframe src="https://codesandbox.io/embed/p514nlnnvx?fontsize=14" title="[prevent-scroll] 1. base-modal" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
</div>
<p>외부 영역의 스크롤은 큰 문제가 아닐 수 있다. 하지만, 의도치 않은 동작이기 때문에 가능하면 스크롤을 막는게 좋다. <code class="language-text">react-modal</code> githup 저장소의 <a href="https://github.com/reactjs/react-modal/issues">issue</a>탭에서 <code class="language-text">scroll</code>, <code class="language-text">body scroll</code>, <code class="language-text">prevent scroll</code> 등의 키워드로 검색(closed 포함)해보면 꽤 많은 사람들이 이 문제를 겪고 있음을 알게된다(<a href="https://github.com/reactjs/react-modal/issues/191">대표적인 issue</a>). 가장 많이 등장하는 해결책은 바로 아래 css 코드를 추가하는 것이다.</p>
<h3>첫번째 방법: (overflow: hidden;)</h3>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token selector">.ReactModal__Body--open</span> <span class="token punctuation">{</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>해보면, 잘된다. 적어도 데스크탑에서는 잘 된다.
그런데 issue를 조금 더 보면 모바일에서 여전히 스크롤이 발생한다는 보고가 군데군데 보인다.
모바일에서 테스트해보자. 정말 <code class="language-text">안된다!</code></p>
<h3>두번째 방법: 스타일을 좀 더 추가하자.</h3>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token selector">.ReactModal__Body--open</span> <span class="token punctuation">{</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>되는것 같이(?) 보인다. 그런데, 좀더 테스트 해보면 문제가 있음을 알 수 있다. 스크롤을 아래로 내린 상태에서 <code class="language-text">modal 열기</code> 버튼을 클릭하자. 그러면 스크롤이 가장 상위로 올라간다. 이는 확실히 문제가 있다. 예를들어 스크롤 뷰어(웹툰이라고 상상하자)에서 특정 버튼을 눌렀을때 모달뷰가 뜨는 경우가 있다. 중간정도 위치를 보는 중이었는데 갑자기 모달이 뜨면서 스크롤이 가장 위로 올라가면 사용자는 자신이 보던 위치를 잃어버리게 된다. 그러므로 위 방법이 적절한 해결책은 아니다.</p>
<h3>세번째 방법: 다른 패키지를 써라</h3>
<p>스타일로는 해결이 안되는것 같다(찾지 못했다가 정확하다). 문득 react-modal의 문제일수도 있다는 생각이 들었다. react-modal 대신 react-aria-modal 패키지를 쓰면 해결된다는 글이 있길래 설치하고 테스트 해보았다.
그러나 마찬가지로 <code class="language-text">실패</code></p>
<h3>네번째 방법: touchmove 이벤트를 이용하자</h3>
<p>네번째 방법은 modal이 떠 있을때(isOpen === true 상태) touchmove 이벤트를 아예 차단하는 방법이다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>showModal<span class="token punctuation">,</span> setShowModal<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handleTouchMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>showModal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 여기가 핵심</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"touchmove"</span><span class="token punctuation">,</span> handleTouchMove<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    passive<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"touchmove"</span><span class="token punctuation">,</span> handleTouchMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>showModal<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>showModal === true일때 <code class="language-text">event.preventDefault()</code>를 호출하고 EventListenerOptions 옵션에 <code class="language-text">passive: false</code>를 설정한다.
첫째는 modal이 떠있을때 <code class="language-text">preventDefault</code> 함수로 터치 이벤트의 기본 동작인 <code class="language-text">scroll</code>을 막겠다는 의도다. 그리고 두번째 <code class="language-text">passive: false</code>는 touch 이벤트가 발생했을때 preventDefault가 호출된다면 이벤트(scroll) 발생을 막겠다는 것이다. passive가 true일때는 preventDefault 함수를 무시하고 scroll을 하겠다는 의미다. passive의 기본값은 false기 때문에 따로 설정할 필요가 없다. 그럼에도 명시적으로 false를 넣어준것은 특정 브라우저 버전이나 기기에서 기본값이 <code class="language-text">true</code>인 경우가 있기 때문이다.</p>
<p>이제 문제가 해결된 것처럼 보인다. 그런데, 만약 모달뷰 내부에 콘텐츠가 길어져서 스크롤이 필요한 경우라면 어떨까? 아래 코드를 테스트해보자 (모바일에서 새 창으로 열어서 테스트해야 정상적으로 확인가능하다.).</p>
<div class="frame-wrap">
<iframe src="https://codesandbox.io/embed/p29k96rq2m?fontsize=14" title="[prevent-scroll] 5. prevent-by-event-bug" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
</div>
<p>모달의 콘텐츠가 길어지니 문제가 생겼다. 외부 스크롤은 잘 막히지만, 정작 필요한 내부 스크롤은 동작하지 않는다. 뭐가 문제일까?</p>
<p>모바일 디바이스에서 touchmove 이벤트와 scroll이 발생하는 시점 사이의 정확한 매커니즘은 잘 모르겠지만, touchmove 이벤트 전파가 완료된 다음 scroll 이벤트가 발생하는것 같다. 그래서 window에 바인딩된 이벤트 핸들러에서 <code class="language-text">preventDefault</code>가 호출되면 스크롤 자체가 막히므로 모달뷰 또한 스크롤되지 않는다.</p>
<blockquote>
<p>전반적으로 react-hooks를 사용하고 있는데, hooks에 익숙하지 않다면 아래 공식 문서를 읽어보자.
<a href="https://reactjs.org/docs/hooks-intro.html">https://reactjs.org/docs/hooks-intro.html</a></p>
</blockquote>
<h3>다섯번째 방법: event 전파를 잘 이용하자.</h3>
<p>이벤트 전파 과정을 잘 이용하면 모달뷰 내 스크롤이 막히는 현상을 해결할 수 있다. 이벤트는 기본적으로 부모 노드부터 타겟 노드로 전파(캡쳐링)되고 그다음 타겟 노드에서 다시 부모 노드로 전파(버블링)된다. 이때 노드에 바인딩한 이벤트 핸들러가 언제 호출될지는 capturing과 bubbling을 옵션으로 정할수 있다. 예를들어 <code class="language-text">EventListenerOptions</code> 객체 기준으로 <code class="language-text">capture: true</code>를 넣어주면 capturing시에 이벤트 핸들러가 실행된다. 기본 값은 false기 때문에 기본적으로 event bubbling시에만 이벤트 핸들러가 실행된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ex) 캡쳐링 이벤트를 감지해서 핸들러 함수(handleClick)를 실행시키고 싶다면..</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">,</span> <span class="token punctuation">{</span>capture<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>조금 생각해보자. 네번째 방법에서 window 객체에 <code class="language-text">touchmove</code> 이벤트를 바인딩 했는데, 이때 capture 옵션을 별도로 넣어주지 않았다. 즉, 이벤트가 버블링될때 핸들러 함수가 실행된다. 이벤트 버블링은 타겟 노드부터 부모 노드 방향으로 이벤트가 전파된다. 그래서 window 객체의 <code class="language-text">handleTouchMove</code> 핸들러 함수는 touchmove 이벤트 전파 중 가장 마지막에 호출된다. 만약, 중간에 어떤 부분(예를들어 .modal-body)에서 이벤트 버블링은 막을수 있다면 결과적으로 handleTouchMove 함수의 호출을 막을수 있다. 그말은 즉, 정상적으로 스크롤을 할수 있게 된다는 의미다. modal-body 클래스 노드에 onTouchMove 이벤트 핸들러를 바인딩하고 핸들러에서 <code class="language-text">e.stopPropagation()</code>을 호출하자. </p>
<blockquote>
<p>참고로 stopPropagation 함수는 더 이상 이벤트가 전파되지 않도록 막는다. </p>
</blockquote>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-body"</span> onTouchMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span></code></pre></div>
<p>내부 영역이 스크롤되면서 외부 영역은 스크롤되지 않는걸 확인할수 있다. 몇번 더 해보자. 이상하다. 간헐적으로 내부 스크롤이 안되고 외부만 스크롤 되는 현상이 발생한다. 좀더 구체적으로 말하자면, 모달뷰가 스크롤 가능할때 가장 위에서 위쪽으로 스크롤을 시도하거나 가장 아래에서 아래쪽으로 스크롤을 시도하면 모달뷰가 아닌 외부의 dimmed 영역이 스크롤 되는 문제(?)가 있다(모바일만..). 심지어 touchmove 이벤트가 dimmed 영역으로 전파되지 않았음에도 말이다. 아마 터치 이벤트가 종료되더라도 계속해서 스크롤이 이어지는 모멘텀(Momentum) 스크롤 때문이 아닐까 조심스레 추측해본다(정말??).</p>
<h3>여섯번째 방법: 마지막(?)</h3>
<p>마지막 방법이다. 최소한 내가 찾은 마지막 방법이다. 출처를 밝히고 싶은데, 기록은 안해둬서 찾기가 어렵다. 아무튼 다섯번째 방법에서 발생했던 문제를 해결하는 방법은 다음과 같다.  </p>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token selector"># css
.modal-body</span> <span class="token punctuation">{</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> &lt;- modal 높이와 동일하게 맞춰준다.
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"># react
<span class="token operator">...</span>
<span class="token keyword">const</span> divRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>divRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">preventMomentumScroll</span><span class="token punctuation">(</span>divRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>divRef<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">...</span>
  <span class="token operator">&lt;</span>div
    ref<span class="token operator">=</span><span class="token punctuation">{</span>divRef<span class="token punctuation">}</span>
    className<span class="token operator">=</span><span class="token string">"modal-body"</span>
    onScroll<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">preventMomentumScroll</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 이 코드가 없다면 가장 위일때와 가장 아래일때 한번더 touchmove가 발생해야 스크롤이 동작한다.</span>
    onTouchMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preventMomentumScroll</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">></span>
  <span class="token operator">...</span>
<span class="token punctuation">)</span>

<span class="token comment">// 여기가 핵심이다. 가장 위일때는 +1, 가장 아래일때는 -1</span>
<span class="token keyword">function</span> <span class="token function">preventMomentumScroll</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> scrollTop<span class="token punctuation">,</span> offsetHeight<span class="token punctuation">,</span> scrollHeight <span class="token punctuation">}</span> <span class="token operator">=</span> el<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">+</span> offsetHeight <span class="token operator">>=</span> scrollHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> scrollHeight <span class="token operator">-</span> offsetHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>반드시 모바일에서 새창으로 열어서 확인하자.</p>
<div class="frame-wrap">
<iframe src="https://codesandbox.io/embed/xlm05zzzyo?fontsize=14" title="[prevent-scroll] 7. final" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
</div>
<p>스크롤의 가장 위와 가장 아래에서 발생하는 문제이기 때문에 해당 위치에서 별도의 처리를 한다. scroll이 가장 위일때는 1px만큼 더해주고, 가장 아래일때는 1px만큼 빼준다. 이때는 위치만 보정해줘야 한다. 버블링을 막지 않기 위해 <code class="language-text">stopPropagation</code>을 호출하지 않고 window로 터치 이벤트를 버블링한다. 그리고 window의 터치 이벤트 핸들러에서 <code class="language-text">preventDefault</code>을 호출해서 외부 스크롤을 막아준다. 여기서 끝이 아니다. 스크롤을 시도했는데 위치만 보정되고 실제로 스크롤이 동작하지 않는다면 이 또한 문제다. <code class="language-text">onScroll</code> 이벤트 핸들러를 <code class="language-text">modal-body</code>에 추가한다. scroll은 touchmove보다 늦게 호출된다. 그렇기 때문에 scroll이 호출될 시점에 이미 스크롤 위치가 보정되어 있다. 그러면 아마도 문제 없이 스크롤이 동작하게 된다. 추가로 최초 로딩(모달이 열렸을때)되었을때는 스크롤 위치가 가장 상단에 위치하므로 useEffect에서 스크롤 위치 보정 함수 <code class="language-text">preventMomentumScroll</code>을 호출해준다.</p>
<h3>정리</h3>
<p>완벽한 해결책이라고는 생각하지 않는다. 데스크탑이나 모바일에서 이벤트 발생이나 전파 방식에는 차이가 있을 수 있기 때문에 그 특성을 고려해서 보완하는 코드를 추가한것 뿐이다. 그래도 이번 이슈를 해결하면서 이벤트 버블링(또는 캡쳐링)이나 모바일에서의 스크롤 동작같은 세부적인 내용에 대해 살짝 맛본것에 의의를 두는것으로 만족한다. </p>
<h3>참고자료</h3>
<ul>
<li><a href="http://sculove.github.io/blog/2016/12/29/addEventListener-passive/">addEventListener의 옵션들</a></li>
</ul></div><div class="sc-AxjAm cJBtFD"></div><div font-size="15px" class="sc-AxjAm sc-AxirZ blog-post___StyledFlex-sc-13kot0y-1 hSJHkQ"><div class="sc-AxjAm sc-AxiKw blog-post___StyledText-sc-13kot0y-2 kiTuVM"><a rel="prev" href="/2018/12/31/about-2018/">2018 회고</a></div><div class="sc-AxjAm sc-AxiKw blog-post___StyledText2-sc-13kot0y-3 dUhyew"><a rel="next" href="/2019/05/06/screw-up-routine/">일상이 망가졌다 (feat. 고양이의 보은)</a></div></div><div class="sc-AxjAm dvqQYw"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4588610260101909" data-ad-slot="5306007932" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div shortname="bonogithub" config="[object Object]" id="disqus_thread"></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-50048807-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2019/04/24/prevent-scroll-outside/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-11b3c027aedda7ebd9e8.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-99ed5caf1e3f27d98142.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9a070ee3a9d62e01018a.js"],"component---src-pages-essay-js":["/component---src-pages-essay-js-44069cdd8283fe173a08.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d4ab21ab82142f195dbd.js"],"component---src-pages-interactive-web-js":["/component---src-pages-interactive-web-js-bf850b0b8107c8a98dc9.js"],"component---src-pages-programming-js":["/component---src-pages-programming-js-fcd110ef86ca69fa15f8.js"],"component---src-pages-review-js":["/component---src-pages-review-js-6860c696d47da165ea8e.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-c6e98d1c6ff983bc2798.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f2689ed479cfe464a093.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-725fe24452941634fbdc.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-f2689ed479cfe464a093.js" async=""></script><script src="/ec56ea7fc1ab969d448a8b0cbe19e123f99d0282-3a99fceca4bc424f3755.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-11b3c027aedda7ebd9e8.js" async=""></script><script src="/framework-c034a59c69769c9f4a47.js" async=""></script><script src="/webpack-runtime-d39a85d387998099c779.js" async=""></script></body></html>